<?xml version="1.0" encoding="utf-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                    xmlns:pages="clr-namespace:TkOlympApp.Pages"
                    xmlns:svc="clr-namespace:TkOlympApp.Services"
                    xmlns:conv="clr-namespace:TkOlympApp.Converters">

    <!-- Week Header Template -->
    <DataTemplate x:Key="CalendarWeekHeaderTemplate" x:DataType="pages:WeekHeaderRow">
        <Grid Margin="6,12,6,0">
            <BoxView Style="{StaticResource GroupHeaderBackground}" />
            <Label Text="{Binding WeekLabel}"
                   FontAttributes="Bold"
                   HorizontalTextAlignment="Center"
                   VerticalTextAlignment="Center"
                   Padding="8" />
        </Grid>
    </DataTemplate>

    <!-- Day Header Template -->
    <DataTemplate x:Key="CalendarDayHeaderTemplate" x:DataType="pages:DayHeaderRow">
        <Label Text="{Binding DayLabel}"
               FontAttributes="Bold"
               Margin="6,8,6,4" />
    </DataTemplate>

    <!-- Single Event Card Template -->
    <DataTemplate x:Key="CalendarSingleEventTemplate" x:DataType="pages:SingleEventRow">
        <Grid Margin="6">
            <BoxView Style="{StaticResource SelectableItemBackground}" />
            <VerticalStackLayout Spacing="6" Padding="12">
                <!-- Title row with event type and cohort dot -->
                <Grid ColumnDefinitions="*,Auto">
                    <Label Text="{Binding EventName}"
                           FontAttributes="Bold"
                           Grid.Column="0">
                        <Label.Triggers>
                            <DataTrigger TargetType="Label"
                                       Binding="{Binding IsCancelled}"
                                       Value="True">
                                <Setter Property="TextDecorations" Value="Strikethrough" />
                            </DataTrigger>
                        </Label.Triggers>
                    </Label>

                    <HorizontalStackLayout Spacing="6"
                                         HorizontalOptions="End"
                                         VerticalOptions="Center"
                                         Grid.Column="1">
                        <Label Text="{Binding EventTypeLabel}"
                               FontSize="12"
                               Style="{StaticResource MutedLabelStyle}"
                               VerticalOptions="Center" />

                        <!-- Cohort color circle -->
                        <BoxView x:Name="CohortCircle"
                                 Style="{StaticResource CohortCircle}"
                                 IsVisible="{Binding EventTargetCohortsList, Converter={conv:CohortHasColorConverter}}"
                                 Background="{Binding EventTargetCohortsList, Converter={conv:CohortColorConverter}}" />
                    </HorizontalStackLayout>
                </Grid>

                <Label Text="{Binding LocationOrTrainers}" />
                <Label Text="{Binding TimeRange}"
                       FontSize="12"
                       Style="{StaticResource MutedLabelStyle}" />
            </VerticalStackLayout>
        </Grid>
    </DataTemplate>

    <!-- Trainer Group Header Template -->
    <DataTemplate x:Key="CalendarTrainerGroupHeaderTemplate" x:DataType="pages:TrainerGroupHeaderRow">
        <Grid Margin="6,6,6,0">
            <BoxView Style="{StaticResource GroupHeaderBackground}" />
            <Grid ColumnDefinitions="*,Auto" Padding="12,8">
                <Label Text="{Binding TrainerTitle}"
                       FontAttributes="Bold"
                       Grid.Column="0" />

                <HorizontalStackLayout Spacing="6"
                                     HorizontalOptions="End"
                                     VerticalOptions="Center"
                                     Grid.Column="1">
                    <Label Text="{svc:Translate EventType_Lesson}"
                           FontSize="12"
                           Style="{StaticResource MutedLabelStyle}"
                           VerticalOptions="Center" />

                    <!-- Cohort color circle -->
                    <BoxView Style="{StaticResource CohortCircle}"
                             IsVisible="{Binding EventTargetCohortsList, Converter={conv:CohortHasColorConverter}}"
                             Background="{Binding EventTargetCohortsList, Converter={conv:CohortColorConverter}}" />
                </HorizontalStackLayout>
            </Grid>
        </Grid>
    </DataTemplate>

    <!-- Trainer Detail Row Template -->
    <DataTemplate x:Key="CalendarTrainerDetailTemplate" x:DataType="pages:TrainerDetailRow">
        <Grid Margin="6,3">
            <BoxView Style="{StaticResource SelectableItemBackground}" />
            <Grid ColumnDefinitions="120,Auto,*,Auto"
                  Padding="12,8"
                  ColumnSpacing="8">
                <!-- Time -->
                <Label Text="{Binding TimeRange}"
                       Grid.Column="0">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label"
                                   Binding="{Binding IsCancelled}"
                                   Value="True">
                            <Setter Property="TextDecorations" Value="Strikethrough" />
                        </DataTrigger>
                    </Label.Triggers>
                </Label>

                <!-- Cohort color circle -->
                <BoxView Style="{StaticResource CohortCircleLarge}"
                         Grid.Column="1"
                         IsVisible="{Binding Instance.Event.EventTargetCohortsList, Converter={conv:CohortHasColorConverter}}"
                         Background="{Binding Instance.Event.EventTargetCohortsList, Converter={conv:CohortColorConverter}}" />

                <!-- Registrant name -->
                <Label Text="{Binding FirstRegistrant}"
                       Grid.Column="2">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label"
                                   Binding="{Binding IsFree}"
                                   Value="True">
                            <Setter Property="Text" Value="{svc:Translate Free}" />
                            <Setter Property="TextColor" Value="Green" />
                        </DataTrigger>
                        <DataTrigger TargetType="Label"
                                   Binding="{Binding IsHighlighted}"
                                   Value="True">
                            <Setter Property="FontAttributes" Value="Bold" />
                        </DataTrigger>
                        <DataTrigger TargetType="Label"
                                   Binding="{Binding IsCancelled}"
                                   Value="True">
                            <Setter Property="TextDecorations" Value="Strikethrough" />
                        </DataTrigger>
                    </Label.Triggers>
                </Label>

                <!-- Duration -->
                <Label Text="{Binding DurationText}"
                       HorizontalOptions="End"
                       Grid.Column="3">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label"
                                   Binding="{Binding IsCancelled}"
                                   Value="True">
                            <Setter Property="TextDecorations" Value="Strikethrough" />
                        </DataTrigger>
                    </Label.Triggers>
                </Label>
            </Grid>
        </Grid>
    </DataTemplate>

    <!-- Template Selector -->
    <pages:CalendarTemplateSelector x:Key="CalendarTemplateSelector"
                                    WeekHeaderTemplate="{StaticResource CalendarWeekHeaderTemplate}"
                                    DayHeaderTemplate="{StaticResource CalendarDayHeaderTemplate}"
                                    SingleEventTemplate="{StaticResource CalendarSingleEventTemplate}"
                                    TrainerGroupHeaderTemplate="{StaticResource CalendarTrainerGroupHeaderTemplate}"
                                    TrainerDetailTemplate="{StaticResource CalendarTrainerDetailTemplate}" />

</ResourceDictionary>
