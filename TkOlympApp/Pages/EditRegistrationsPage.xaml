<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:svc="clr-namespace:TkOlympApp.Services"
             xmlns:vm="clr-namespace:TkOlympApp.ViewModels"
             x:Class="TkOlympApp.Pages.EditRegistrationsPage"
             x:DataType="vm:EditRegistrationsViewModel"
             Title="{svc:Translate EditRegistrations_Title}">

    <RefreshView x:Name="PageRefresh" IsRefreshing="{Binding IsRefreshing}" Command="{Binding RefreshCommand}">
        <Grid>
            <CollectionView x:Name="RegistrationsCollection" Style="{StaticResource ListCollectionView}" SelectionChanged="OnSelectionChanged" IsGrouped="True" RemainingItemsThreshold="5" RemainingItemsThresholdReached="OnRegistrationsRemainingThresholdReached" VerticalOptions="FillAndExpand">
                <CollectionView.Header>
                    <VerticalStackLayout Padding="16" Spacing="12">
                        <Label Text="{svc:Translate EditRegistrations_Title}" FontAttributes="Bold" FontSize="20" />

                        <Label Text="{svc:Translate EditRegistrations_Description}" />
                    </VerticalStackLayout>
                </CollectionView.Header>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:RegItem">
                        <Border Style="{StaticResource SelectableItemContainer}" Margin="16,4">
                            <VerticalStackLayout Padding="12" Spacing="4">
                                <Label Text="{Binding Text}" FontAttributes="Bold" />
                                <Label Text="{Binding Secondary}" FontSize="12" />
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.Footer>
                    <VerticalStackLayout Padding="16" Spacing="12">
                        <Label x:Name="TrainerSelectionHeader" Text="{svc:Translate EditRegistrations_Trainers_Label}" FontAttributes="Bold" IsVisible="{Binding TrainerSelectionHeaderVisible}" />
                        <CollectionView x:Name="TrainerSelectionCollection" SelectionMode="None" IsVisible="{Binding TrainerSelectionVisible}" ItemsSource="{Binding TrainerOptions}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="vm:TrainerOption">
                                    <Border Style="{StaticResource SelectableItemContainer}">
                                        <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center" Padding="6">
                                            <Label Grid.Column="0" Text="{Binding Name}" VerticalOptions="Center" />
                                            <HorizontalStackLayout Grid.Column="1" Spacing="6" VerticalOptions="Center" HorizontalOptions="End">
                                                <Button Text="-" WidthRequest="28" HeightRequest="28" CornerRadius="8" FontSize="22" Clicked="OnTrainerMinusClicked" Style="{StaticResource ButtonSecondary}"/>
                                                <Label Text="{Binding Count}" VerticalOptions="Center" HorizontalOptions="Center" WidthRequest="28" HorizontalTextAlignment="Center" FontSize="14" />
                                                <Button Text="+" WidthRequest="28" HeightRequest="28" CornerRadius="8" FontSize="22" Clicked="OnTrainerPlusClicked" Style="{StaticResource ButtonSecondary}"/>
                                            </HorizontalStackLayout>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <Button x:Name="ConfirmButton" Text="{svc:Translate EditRegistrations_Button_Text}" IsEnabled="{Binding ConfirmEnabled}" HorizontalOptions="Fill" Command="{Binding ConfirmCommand}" />

                        <!-- Success overlay -->
                        <Editor x:Name="MutationPreview" IsReadOnly="True" IsVisible="False" />
                    </VerticalStackLayout>
                </CollectionView.Footer>

            </CollectionView>

        <Grid x:Name="SuccessOverlay" IsVisible="{Binding SuccessOverlayVisible}" BackgroundColor="#AA000000" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
            <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="12" Padding="24">
                <Border BackgroundColor="#2e7d32" WidthRequest="160" HeightRequest="160" HorizontalOptions="Center" VerticalOptions="Center">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="80" />
                    </Border.StrokeShape>
                    <Label x:Name="SuccessIcon" Text="âœ”" FontSize="96" TextColor="White" HorizontalTextAlignment="Center" VerticalTextAlignment="Center" HorizontalOptions="Center" VerticalOptions="Center" />
                </Border>
                <Label x:Name="SuccessText" Text="{Binding SuccessText}" TextColor="#c8e6c9" FontAttributes="Bold" FontSize="20" HorizontalTextAlignment="Center" />
            </VerticalStackLayout>
        </Grid>
    </Grid>
    </RefreshView>
</ContentPage>
